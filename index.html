<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>0107 Happy Birthday</title>
    <style>
        :root {
            --primary-color: #ff9a9e;
            --secondary-color: #fad0c4;
            --card-bg: #fffdf9;
            --text-color: #555;
            --heart-color: #ff4d6d;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);
            font-family: "Microsoft JhengHei", "Noto Sans TC", sans-serif;
            overflow: hidden;
            user-select: none;
            position: relative;
        }

        /* === å…¨åŸŸç‰¹æ•ˆ === */
        #canvas-trail { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 20; }

        .container {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
            opacity: 0; pointer-events: none; z-index: 0;
            transform: scale(0.95);
        }
        .container.active { opacity: 1; pointer-events: auto; z-index: 30; transform: scale(1); }

        /* === Stage 0: å¯†ç¢¼é– === */
        #stage-lock { background: rgba(255, 255, 255, 0.95); z-index: 100; }
        input[type="text"] {
            font-size: 24px; padding: 10px; width: 150px; text-align: center;
            border: none; border-bottom: 3px solid #ddd; outline: none; background: transparent;
            letter-spacing: 5px; margin-bottom: 20px; color: var(--text-color); transition: 0.3s;
        }
        input[type="text"]:focus { border-bottom-color: var(--primary-color); }

        /* === Stage 1: æµªæ¼«æ°›åœ === */
        .float-msg {
            position: absolute; padding: 12px 24px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border-radius: 16px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid rgba(255, 236, 240, 0.8);
            color: #444; font-size: 16px;
            font-family: "Palatino Linotype", serif; letter-spacing: 1px;
            animation: driftUpText 6s ease-out forwards;
            pointer-events: auto; z-index: 10;
            min-width: 120px; text-align: center;
        }
        @keyframes driftUpText {
            0% { transform: translateY(0) scale(0.9); opacity: 0; }
            10% { opacity: 1; transform: translateY(-20px) scale(1); }
            80% { opacity: 0.9; }
            100% { transform: translateY(-300px) scale(0.95); opacity: 0; }
        }

        .pop-heart {
            position: absolute; color: var(--heart-color); font-size: 24px;
            animation: floatUpHeart 2.5s ease-in-out forwards;
            z-index: 5; pointer-events: none;
        }
        @keyframes floatUpHeart {
            0% { transform: translateY(10px) scale(0.8); opacity: 0; }
            20% { opacity: 0.8; }
            100% { transform: translateY(-120px) scale(1.4); opacity: 0; }
        }

        .main-btn {
            margin-top: 30px; padding: 12px 35px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white; border: none; border-radius: 50px; font-size: 16px; cursor: pointer;
            transition: 0.3s; box-shadow: 0 8px 20px rgba(255, 154, 158, 0.3);
        }
        .main-btn:hover { transform: translateY(-3px); box-shadow: 0 12px 25px rgba(255, 154, 158, 0.5); }
        #nextLevelBtn { margin-top: 280px; opacity: 0; z-index: 10; font-size: 18px; padding: 15px 45px;}

        /* === Stage 2: ç¦®ç‰©ç›’ === */
        .box-emoji { font-size: 120px; cursor: pointer; transition: transform 0.1s; }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(-5deg); } 75% { transform: rotate(5deg); } }
        #progressBarContainer { width: 220px; height: 10px; background: #eee; border-radius: 5px; margin: 25px 0; overflow: hidden; }
        #progressBar { width: 0%; height: 100%; background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); transition: width 0.1s; }

        /* === Stage 3: é–‹ç === */
        .reveal-content { 
            font-size: 32px; font-weight: 800; color: #444; margin: 20px 0; white-space: pre-wrap; line-height: 1.4;
            background: linear-gradient(45deg, #ff9a9e, #ff6b6b); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: popIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            padding: 20px;
        }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1.1); opacity: 1; } }

        /* === Stage 4: å¡ç‰‡ === */
        .card-style {
            background-color: var(--card-bg);
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
            padding: 40px 30px; border-radius: 24px; text-align: center; max-width: 340px; width: 88%;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); border: 1px solid #f0e6e6;
            max-height: 85vh; overflow-y: auto;
        }
        .message-text { color: #555; font-size: 15px; line-height: 1.8; font-family: "Noto Serif TC", serif; text-align: left;}
        .highlight { color: #d87a7a; font-weight: bold; border-bottom: 2px solid #fad0c4; }

        /* Confetti */
        .confetti { position: absolute; width: 10px; height: 10px; z-index: 50; pointer-events: none; }
    </style>
</head>
<body>

    <canvas id="canvas-trail"></canvas>

    <!-- Stage 0 -->
    <div id="stage-lock" class="container active">
        <h2 style="color:#555; letter-spacing: 2px; font-weight: normal;">0107 Birthday</h2>
        <input type="text" id="passInput" placeholder="è¼¸å…¥å¯†ç¢¼" maxlength="4" inputmode="numeric">
    </div>

    <!-- Stage 1 -->
    <div id="stage-text" class="container">
        <button id="nextLevelBtn" class="main-btn">âœ¨ æ”¶ä¸‹é©šå–œ</button>
    </div>

    <!-- Stage 2 -->
    <div id="stage-box" class="container">
        <div style="color:#777; margin-bottom:25px; font-size: 18px;">é€£çºŒé»æ“Šæ‰“é–‹å®ƒï¼</div>
        <div class="box-emoji" id="giftBox">ğŸ</div>
        <div id="progressBarContainer"><div id="progressBar"></div></div>
    </div>

    <!-- Stage 3 -->
    <div id="stage-reveal" class="container">
        <div style="font-size: 18px; color: #888; letter-spacing: 2px;">âœ¨ CONGRATS âœ¨</div>
        <div id="finalPrizeText" class="reveal-content">...</div>
        <button id="goToCardBtn" class="main-btn">ğŸ’Œ è®€ä¸€å°ä¿¡</button>
    </div>

    <!-- Stage 4 -->
    <div id="stage-card" class="container">
        <div class="card-style">
            <div id="card-title" style="font-size: 13px; color: var(--primary-color); letter-spacing: 4px; font-weight: bold; margin-bottom: 25px;">MEMORIES & WISHES</div>
            <div class="message-text">
                <span id="card-opening" style="font-size: 18px; font-weight: bold; display:block; margin-bottom: 15px; color: #333;"></span>
                <div id="card-body">
                    <!-- é€™è£¡æœƒå¡«å…¥å¡ç‰‡æ­£æ–‡ -->
                </div>
            </div>
            <div id="card-signature" style="font-size: 14px; color: #888; margin-top: 30px; text-align: right; font-weight: bold;">
            </div>
        </div>
    </div>

    <script>
        /**
         * ==========================================
         * âœ¨ æ‰€æœ‰çš„æ–‡å­—å…§å®¹éƒ½åœ¨é€™è£¡è¨­å®š âœ¨
         * ==========================================
         */
        const APP_CONTENT = {
            passcode: "0107",

            floatingTexts: [
                "0107 ç”Ÿæ—¥å¿«æ¨‚ï¼", 
                "é¡˜å¦³çœ¼è£¡æ°¸é æœ‰å…‰", 
                "ä»Šå¤©çš„å¦³ç‰¹åˆ¥è€€çœ¼",
                "è¦æŠŠç…©æƒ±éƒ½æ¸…ç©ºå–”", 
                "è¬è¬å¦³çš„å­˜åœ¨",
                "è¦å¤©å¤©é–‹å¿ƒ",
                "âœ¨ Happy Birthday âœ¨"
            ],
            
            prizes: [
                "è«‹å–ä¸€æ¯é£²æ–™åˆ¸\n(å£å‘³ä»»é¸)", 
                "ç„¡æ¢ä»¶è½å¦³æŠ±æ€¨åˆ¸\n(éš¨æ™‚æœ‰æ•ˆ)",
                "å¿ƒæƒ…å¥½è½‰åˆ¸\n(è² è²¬é€—å¦³ç¬‘)", 
                "è¬èƒ½è¨±é¡˜åˆ¸\n(å¦³èªªä»€éº¼å°±æ˜¯ä»€éº¼)",
                "é»å¿ƒé¤µé£Ÿåˆ¸\n(éš¨æ©Ÿæ‰è½é›¶é£Ÿ)"
            ],
            
            // --- é€™æ˜¯æ‚¨çš„ä¿¡ä»¶å…§å®¹ ---
            cardOpening: "Dear å¯æ„›æ•¸å­¸å°è€å¸«ï¼š",
            cardBody: `é€™æ˜¯æˆ‘å€‘ç›¸è­˜å¾Œçš„ç¬¬äºŒå€‹ç”Ÿæ—¥ã€‚å›é¦–é€™æ®µæ—¥å­ï¼Œé›–ç„¶æˆ‘å€‘æ›¾ä¸€èµ·èµ°éä¸€äº›é›¨å¤©ï¼Œä¹Ÿç¶“æ­·éäº›è¨±ç£•çµ†ï¼Œä½†æ­£æ˜¯é€™äº›ä¸å®Œç¾ï¼Œè®“æˆ‘æ›´çæƒœç¾åœ¨èƒ½ä»¥æœ‹å‹èº«åˆ†é™ªåœ¨å¦³èº«é‚Šçš„æ™‚åˆ»ã€‚<br><br>
                       è¬è¬å¦³ä¸€ç›´ä»¥ä¾†çš„åŒ…å®¹èˆ‡é™ªä¼´ï¼Œå¦³çš„å–„è‰¯èˆ‡çŸ¥æ€§æ˜¯æˆ‘ç”Ÿå‘½ä¸­å¾ˆç‰¹åˆ¥çš„å­˜åœ¨ã€‚éå»çš„æ­²æœˆæ„Ÿè¬æœ‰å¦³åƒèˆ‡ï¼Œæœªä¾†çš„æ—¥å­ï¼Œä¹Ÿè«‹è®“æˆ‘å€‘ç¹¼çºŒä¸¦è‚©å‰è¡Œï¼Œäº’ç›¸æŒ‡æ•™ã€‚<br><br>
                       <span class="highlight">èƒ½é‡è¦‹å¦³ï¼Œæ˜¯æˆ‘é€™ä»½äººç”Ÿè€ƒå·è£¡æœ€å¹¸é‹çš„ç­”æ¡ˆã€‚</span><br><br>
                       ç¥å¦³ ç”Ÿæ—¥å¿«æ¨‚ï¼Œé¡˜å¦³æ¯ä¸€å¤©éƒ½å……æ»¿ç¬‘å®¹`,
            cardSignature: "æ—åšç¨‹ æ•¬ä¸Š"
        };

        /**
         * ç¨‹å¼åŸ·è¡Œé‚è¼¯
         */
        document.getElementById('card-opening').innerText = APP_CONTENT.cardOpening;
        document.getElementById('card-body').innerHTML = APP_CONTENT.cardBody;
        document.getElementById('card-signature').innerText = APP_CONTENT.cardSignature;

        const canvas = document.getElementById('canvas-trail');
        const ctx = canvas.getContext('2d');
        let particles = [];
        const colors = ['#ff9a9e', '#fad0c4', '#fbc2eb', '#ffffff'];
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();
        
        const createParticle = (x, y) => {
            particles.push({
                x, y, text: 'â™¥', color: colors[Math.floor(Math.random() * colors.length)],
                size: Math.random() * 15 + 8, speedX: Math.random() * 2 - 1, speedY: Math.random() * 2 - 1, life: 1
            });
        }
        window.addEventListener('mousemove', e => createParticle(e.clientX, e.clientY));
        window.addEventListener('touchmove', e => createParticle(e.touches[0].clientX, e.touches[0].clientY));
        
        function animateTrail() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach((p, i) => {
                p.x += p.speedX; p.y += p.speedY; p.life -= 0.03; p.size *= 0.95;
                ctx.fillStyle = p.color; ctx.globalAlpha = p.life;
                ctx.font = `bold ${p.size}px sans-serif`;
                ctx.fillText(p.text, p.x, p.y);
            });
            particles = particles.filter(p => p.life > 0);
            requestAnimationFrame(animateTrail);
        }
        animateTrail();

        const passInput = document.getElementById('passInput');
        passInput.addEventListener('input', (e) => {
            if(e.target.value === APP_CONTENT.passcode) {
                passInput.blur();
                switchStage('stage-lock', 'stage-text');
                startFloatingSequence();
            }
        });

        function startFloatingSequence() {
            const stageText = document.getElementById('stage-text');
            const interval = setInterval(() => {
                const textContent = APP_CONTENT.floatingTexts[Math.floor(Math.random() * APP_CONTENT.floatingTexts.length)];
                const el = document.createElement('div');
                el.className = 'float-msg';
                const rx = Math.random() * 70 + 15; const ry = Math.random() * 40 + 45;
                el.style.left = rx + '%'; el.style.top = ry + '%';
                stageText.appendChild(el);
                
                let i = 0;
                function type() {
                    if (i < textContent.length) { el.innerHTML += textContent.charAt(i); i++; setTimeout(type, 40); }
                }
                type();
                setTimeout(() => el.remove(), 6000);
            }, 600);

            setTimeout(() => {
                const btn = document.getElementById('nextLevelBtn'); btn.style.opacity = 1;
                btn.onclick = () => { clearInterval(interval); switchStage('stage-text', 'stage-box'); };
            }, 4000);
        }

        let clickCount = 0;
        const box = document.getElementById('giftBox');
        box.onclick = () => {
            clickCount++;
            document.getElementById('progressBar').style.width = (clickCount/10)*100 + '%';
            box.classList.remove('shake'); void box.offsetWidth; box.classList.add('shake');
            box.style.transform = `scale(${1 + clickCount*0.05})`;
            if(clickCount >= 10) {
                setTimeout(() => {
                    const prize = APP_CONTENT.prizes[Math.floor(Math.random() * APP_CONTENT.prizes.length)];
                    document.getElementById('finalPrizeText').innerText = prize;
                    switchStage('stage-box', 'stage-reveal');
                    startConfetti();
                }, 500);
            }
        };

        document.getElementById('goToCardBtn').onclick = () => switchStage('stage-reveal', 'stage-card');

        function switchStage(hide, show) {
            document.getElementById(hide).classList.remove('active');
            setTimeout(() => document.getElementById(show).classList.add('active'), 600);
        }

        function startConfetti() {
            for(let i=0; i<80; i++) {
                let c = document.createElement('div'); c.className = 'confetti';
                c.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
                c.style.left = Math.random()*100 + 'vw'; c.style.top = '-10px';
                c.style.animation = `drop ${Math.random()*3+2}s forwards`;
                document.body.appendChild(c);
            }
            let s = document.createElement('style');
            s.innerHTML = `@keyframes drop { to { transform: translateY(105vh) rotate(360deg); opacity: 0; } }`;
            document.head.appendChild(s);
        }
    </script>
</body>
</html>
